$(function(){if($.cookie("captcha")){var count=$.cookie("captcha"),btn=$("#getting");btn.val(count+"秒后可重新获取").attr("disabled",!0).css("cursor","not-allowed");var resend=setInterval(function(){count--,count>0?(btn.val(count+"秒后可重新获取").attr("disabled",!0).css("cursor","not-allowed"),$.cookie("captcha",count,{path:"/",expires:1/86400*count})):(clearInterval(resend),btn.val("获取验证码").removeClass("disabled").removeAttr("disabled style"))},1e3)}$("#getting").click(function(){var btn=$(this),count=60,mobile=$('#appointForm input[name="mobile"]').val(),myreg=/^(1[3|4|5|7|8]\d{9})$/;return""==mobile?($('#appointForm input[name="mobile"]').addClass("subs_hint"),$("#mobileError").show(),!1):myreg.test(mobile)?void $.ajax({url:"/cemetery/sendmessage.html",type:"POST",data:"mobile="+mobile,success:function(d){var result=eval("("+d+")");if(1==result.flag){var resend=setInterval(function(){count--,count>0?(btn.val(count+"秒后可重新获取"),$.cookie("captcha",count,{path:"/",expires:1/86400*count})):(clearInterval(resend),btn.val("获取验证码").removeAttr("disabled style"))},1e3);btn.attr("disabled",!0).css("cursor","not-allowed")}else $("#content").empty().append(result.msg),$(".tooltip_pers").css({display:"block"}),$(".tooltip_box").css({display:"block"})}}):($(this).addClass("subs_hint"),$("#mobileError").html("<i></i>请输入正确的手机号"),$("#mobileError").show(),!1)}),$(".tooltip_cloce, .ack_btn").click(function(o){$(".tooltip_pers").css({display:"none"}),$(".tooltip_box").css({display:"none"})}),$(".subs_btn").click(function(){var error=!1,buyer=$('#appointForm input[name="buyer"]').val(),mobile=$('#appointForm input[name="mobile"]').val(),msgcode=$('#appointForm input[name="msgcode"]').val(),appoint_time=$('#appointForm input[name="appoint_time"]').val(),sesssionMobile=sm;if(""==buyer&&(error=!0,$('#appointForm input[name="buyer"]').addClass("subs_hint"),$("#buyerError").show()),""==mobile&&(error=!0,$('#appointForm input[name="mobile"]').addClass("subs_hint"),$("#mobileError").show()),(""!=sesssionMobile&&sesssionMobile!=mobile||""==sesssionMobile)&&""==msgcode&&(error=!0,$('#appointForm input[name="msgcode"]').addClass("subs_hint"),$("#msgcodeError").show()),error)return!1;var store_name=$(".appoint_cemetery_name").attr("data-value");return $.ajax({url:"/cemetery/submitappoint.html",type:"POST",data:$("#appointForm").serialize(),success:function(d){var result=eval("("+d+")");10==result.flag?($("#content").empty().append(result.msg),$(".tooltip_pers").css({display:"block"}),$(".tooltip_box").css({display:"block"}),setTimeout(function(){window.location.href="/myorder"},2e3)):2==result.flag?($("#msgcodeError").html("<i></i>"+result.msg),$("#msgcodeError").show()):($("#buyerError").html("<i></i>"+result.msg),$("#buyerError").show())}}),!1}),$('#appointForm input[name="buyer"]').blur(function(){var o=$(this).val();""==o?($(this).addClass("subs_hint"),$("#buyerError").show()):($(this).removeClass("subs_hint"),$("#buyerError").hide())}),$('#appointForm input[name="mobile"]').blur(function(){var o=$(this).val(),t=/^(1[3|4|5|7|8]\d{9})$/,e=($("#getting"),"{$Think.session.member_mobile}");""==o?($(this).addClass("subs_hint"),$("#mobileError").show()):t.test(o)?(""!=e&&e!=o||""==e?($(".getcode_btn").show(),$(".msgcode").show()):($(".getcode_btn").hide(),$(".msgcode").hide()),$(this).removeClass("subs_hint"),$("#mobileError").hide()):($(this).addClass("subs_hint"),$("#mobileError").html("<i></i>请输入正确的手机号"),$("#mobileError").show())}),$('#appointForm input[name="msgcode"]').blur(function(){var o=$(this).val();""==o?($(this).addClass("subs_hint"),$("#msgcodeError").show()):($(this).removeClass("subs_hint"),$("#msgcodeError").hide())}),$('#appointForm input[name="appoint_time"]').blur(function(){var o=$(this).val();""==o?($(this).addClass("subs_hint"),$("#appointtimeError").show()):($(this).removeClass("subs_hint"),$("#appointtimeError").hide())}),$('#appointForm input[name="appoint_time"]').focus(function(){var o=$(this).val();""!=o&&($(this).removeClass("subs_hint"),$("#appointtimeError").hide())}),$(".tooltip_cloce, .ack_btn").click(function(o){$(".tooltip_pers").css({display:"none"}),$(".tooltip_box").css({display:"none"})})});